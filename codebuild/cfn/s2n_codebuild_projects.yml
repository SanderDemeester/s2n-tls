AWSTemplateFormatVersion: '2010-09-09'
Outputs:
  CodeBuildProjects2nAsanOpenSSL111Gcc6Coverage:
    Value: !Ref 's2nAsanOpenSSL111Gcc6Coverage'
  CodeBuildProjects2nIntegrationBoringSSLGcc9:
    Value: !Ref 's2nIntegrationBoringSSLGcc9'
  CodeBuildProjects2nIntegrationLibreSSLGcc9:
    Value: !Ref 's2nIntegrationLibreSSLGcc9'
  CodeBuildProjects2nIntegrationOpenSSL102Gcc6:
    Value: !Ref 's2nIntegrationOpenSSL102Gcc6'
  CodeBuildProjects2nIntegrationOpenSSL102Gcc6FIPS:
    Value: !Ref 's2nIntegrationOpenSSL102Gcc6FIPS'
  CodeBuildProjects2nIntegrationOpenSSL111Gcc6Corked:
    Value: !Ref 's2nIntegrationOpenSSL111Gcc6Corked'
  CodeBuildProjects2nIntegrationOpenSSL111Gcc6Coverage:
    Value: !Ref 's2nIntegrationOpenSSL111Gcc6Coverage'
  CodeBuildProjects2nIntegrationOpenSSL111Gcc6SoftCrypto:
    Value: !Ref 's2nIntegrationOpenSSL111Gcc6SoftCrypto'
  CodeBuildProjects2nIntegrationOpenSSL111Gcc9:
    Value: !Ref 's2nIntegrationOpenSSL111Gcc9'
  CodeBuildProjects2nSawBike:
    Value: !Ref 's2nSawBike'
  CodeBuildProjects2nSawHmacPlus:
    Value: !Ref 's2nSawHmacPlus'
  CodeBuildProjects2nSawTls:
    Value: !Ref 's2nSawTls'
  CodeBuildProjects2nSidetrail:
    Value: !Ref 's2nSidetrail'
  CodeBuildProjects2nValgrindOpenSSL102Gcc6:
    Value: !Ref 's2nValgrindOpenSSL102Gcc6'
  CodeBuildProjects2nValgrindOpenSSL102Gcc6Fips:
    Value: !Ref 's2nValgrindOpenSSL102Gcc6Fips'
  CodeBuildProjects2nValgrindOpenSSL111Gcc9:
    Value: !Ref 's2nValgrindOpenSSL111Gcc9'
  CodeBuildProjects2nfuzzerOpenSSL102FIPS:
    Value: !Ref 's2nfuzzerOpenSSL102FIPS'
  CodeBuildProjects2nfuzzerOpenSSL111Coverage:
    Value: !Ref 's2nfuzzerOpenSSL111Coverage'
  s2nAsanOpenSSL111Gcc6CoverageRole:
    Value: !Ref 's2nAsanOpenSSL111Gcc6CoverageRole'
  s2nIntegrationBoringSSLGcc9Role:
    Value: !Ref 's2nIntegrationBoringSSLGcc9Role'
  s2nIntegrationLibreSSLGcc9Role:
    Value: !Ref 's2nIntegrationLibreSSLGcc9Role'
  s2nIntegrationOpenSSL102Gcc6FIPSRole:
    Value: !Ref 's2nIntegrationOpenSSL102Gcc6FIPSRole'
  s2nIntegrationOpenSSL102Gcc6Role:
    Value: !Ref 's2nIntegrationOpenSSL102Gcc6Role'
  s2nIntegrationOpenSSL111Gcc6CorkedRole:
    Value: !Ref 's2nIntegrationOpenSSL111Gcc6CorkedRole'
  s2nIntegrationOpenSSL111Gcc6CoverageRole:
    Value: !Ref 's2nIntegrationOpenSSL111Gcc6CoverageRole'
  s2nIntegrationOpenSSL111Gcc6SoftCryptoRole:
    Value: !Ref 's2nIntegrationOpenSSL111Gcc6SoftCryptoRole'
  s2nIntegrationOpenSSL111Gcc9Role:
    Value: !Ref 's2nIntegrationOpenSSL111Gcc9Role'
  s2nSawBikeRole:
    Value: !Ref 's2nSawBikeRole'
  s2nSawHmacPlusRole:
    Value: !Ref 's2nSawHmacPlusRole'
  s2nSawTlsRole:
    Value: !Ref 's2nSawTlsRole'
  s2nSidetrailRole:
    Value: !Ref 's2nSidetrailRole'
  s2nValgrindOpenSSL102Gcc6FipsRole:
    Value: !Ref 's2nValgrindOpenSSL102Gcc6FipsRole'
  s2nValgrindOpenSSL102Gcc6Role:
    Value: !Ref 's2nValgrindOpenSSL102Gcc6Role'
  s2nValgrindOpenSSL111Gcc9Role:
    Value: !Ref 's2nValgrindOpenSSL111Gcc9Role'
  s2nfuzzerOpenSSL102FIPSRole:
    Value: !Ref 's2nfuzzerOpenSSL102FIPSRole'
  s2nfuzzerOpenSSL111CoverageRole:
    Value: !Ref 's2nfuzzerOpenSSL111CoverageRole'
Resources:
  s2nAsanOpenSSL111Gcc6Coverage:
    DependsOn: s2nAsanOpenSSL111Gcc6CoverageRole
    Properties:
      Artifacts:
        Type: NO_ARTIFACTS
      BadgeEnabled: true
      Environment:
        ComputeType: BUILD_GENERAL1_LARGE
        EnvironmentVariables:
          - Name: S2N_LIBCRYPTO
            Value: openssl-1.1.1
          - Name: BUILD_S2N
            Value: 'true'
          - Name: TESTS
            Value: asan
          - Name: GCC_VERSION
            Value: '6'
          - Name: S2N_COVERAGE
            Value: 'true'
          - Name: CODECOV_IO_UPLOAD
            Value: 'true'
        Image: aws/codebuild/standard:4.0
        PrivilegedMode: true
        Type: LINUX_CONTAINER
      Name: s2nAsanOpenSSL111Gcc6Coverage
      ServiceRole: !Ref 's2nAsanOpenSSL111Gcc6CoverageRole'
      Source:
        BuildSpec: codebuild/spec/buildspec_ubuntu.yml
        GitCloneDepth: '1'
        Location: https://github.com/aws/s2n-tls.git
        ReportBuildStatus: true
        Type: GITHUB
      SourceVersion: ''
      TimeoutInMinutes: '90'
    Type: AWS::CodeBuild::Project
  s2nAsanOpenSSL111Gcc6CoverageRole:
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action:
              - sts:AssumeRole
            Effect: Allow
            Principal:
              Service:
                - codebuild.amazonaws.com
      Description: Policy created by CloudFormation.
      Path: /
      Policies:
        - PolicyDocument:
            Statement:
              - Action:
                  - s3:PutObject
                  - s3:GetObject
                  - s3:GetObjectVersion
                  - s3:GetBucketAcl
                  - s3:GetBucketLocation
                Effect: Allow
                Resource:
                  - arn:aws:s3:::s2n-build-artifacts/*
              - Action:
                  - logs:CreateLogGroup
                  - logs:CreateLogStream
                  - logs:PutLogEvents
                Effect: Allow
                Resource:
                  - arn:aws:logs:us-west-2:024603541914:log-group:/aws/codebuild/s2nAsanOpenSSL111Gcc6Coverage:*
              - Action:
                  - codecommit:BatchGet*
                  - codecommit:BatchDescribe*
                  - codecommit:Describe*
                  - codecommit:EvaluatePullRequestApprovalRules
                  - codecommit:Get*
                  - codecommit:List*
                  - codecommit:GitPull
                Effect: Allow
                Resource:
                  - '*'
          PolicyName: CodeBuildArtifactPolicy
    Type: AWS::IAM::Role
  s2nAsanOpenSSL111Gcc6CoverageRule:
    DependsOn: s2nAsanOpenSSL111Gcc6Coverage
    Properties:
      Description: scheduled run Build with CloudFormation
      Name: s2nAsanOpenSSL111Gcc6CoverageEvent
      ScheduleExpression: cron(0 12 * * ? *)
      State: ENABLED
      Targets:
        - Arn: !GetAtt 's2nAsanOpenSSL111Gcc6Coverage.Arn'
          Id: s2nAsanOpenSSL111Gcc6CoverageCWid
          RoleArn: !GetAtt 's2nEventsInvokeCodeBuildRole.Arn'
    Type: AWS::Events::Rule
  s2nCodeBuildGithubRole:
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action:
              - sts:AssumeRole
            Effect: Allow
            Principal:
              Service:
                - codebuild.amazonaws.com
      Path: /
    Type: AWS::IAM::Role
  s2nEventsInvokeCodeBuildRole:
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action:
              - sts:AssumeRole
            Effect: Allow
            Principal:
              Service:
                - events.amazonaws.com
      Path: /
      Policies:
        - PolicyDocument:
            Statement:
              - Action:
                  - codebuild:StartBuild
                Effect: Allow
                Resource:
                  - arn:aws:codebuild:us-west-2:024603541914:project/*
          PolicyName: EventsInvokeCBRole
    Type: AWS::IAM::Role
  s2nIntegrationBoringSSLGcc9:
    DependsOn: s2nIntegrationBoringSSLGcc9Role
    Properties:
      Artifacts:
        Type: NO_ARTIFACTS
      BadgeEnabled: true
      Environment:
        ComputeType: BUILD_GENERAL1_2XLARGE
        EnvironmentVariables:
          - Name: S2N_LIBCRYPTO
            Value: boringssl
          - Name: BUILD_S2N
            Value: 'true'
          - Name: TESTS
            Value: integration
          - Name: GCC_VERSION
            Value: '9'
        Image: aws/codebuild/standard:4.0
        PrivilegedMode: true
        Type: LINUX_CONTAINER
      Name: s2nIntegrationBoringSSLGcc9
      ServiceRole: !Ref 's2nIntegrationBoringSSLGcc9Role'
      Source:
        BuildSpec: codebuild/spec/buildspec_ubuntu.yml
        GitCloneDepth: '1'
        Location: https://github.com/aws/s2n-tls.git
        ReportBuildStatus: true
        Type: GITHUB
      SourceVersion: ''
      TimeoutInMinutes: '90'
    Type: AWS::CodeBuild::Project
  s2nIntegrationBoringSSLGcc9Role:
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action:
              - sts:AssumeRole
            Effect: Allow
            Principal:
              Service:
                - codebuild.amazonaws.com
      Description: Policy created by CloudFormation.
      Path: /
      Policies:
        - PolicyDocument:
            Statement:
              - Action:
                  - s3:PutObject
                  - s3:GetObject
                  - s3:GetObjectVersion
                  - s3:GetBucketAcl
                  - s3:GetBucketLocation
                Effect: Allow
                Resource:
                  - arn:aws:s3:::s2n-build-artifacts/*
              - Action:
                  - logs:CreateLogGroup
                  - logs:CreateLogStream
                  - logs:PutLogEvents
                Effect: Allow
                Resource:
                  - arn:aws:logs:us-west-2:024603541914:log-group:/aws/codebuild/s2nIntegrationBoringSSLGcc9:*
              - Action:
                  - codecommit:BatchGet*
                  - codecommit:BatchDescribe*
                  - codecommit:Describe*
                  - codecommit:EvaluatePullRequestApprovalRules
                  - codecommit:Get*
                  - codecommit:List*
                  - codecommit:GitPull
                Effect: Allow
                Resource:
                  - '*'
          PolicyName: CodeBuildArtifactPolicy
    Type: AWS::IAM::Role
  s2nIntegrationBoringSSLGcc9Rule:
    DependsOn: s2nIntegrationBoringSSLGcc9
    Properties:
      Description: scheduled run Build with CloudFormation
      Name: s2nIntegrationBoringSSLGcc9Event
      ScheduleExpression: cron(0 12 * * ? *)
      State: ENABLED
      Targets:
        - Arn: !GetAtt 's2nIntegrationBoringSSLGcc9.Arn'
          Id: s2nIntegrationBoringSSLGcc9CWid
          RoleArn: !GetAtt 's2nEventsInvokeCodeBuildRole.Arn'
    Type: AWS::Events::Rule
  s2nIntegrationLibreSSLGcc9:
    DependsOn: s2nIntegrationLibreSSLGcc9Role
    Properties:
      Artifacts:
        Type: NO_ARTIFACTS
      BadgeEnabled: true
      Environment:
        ComputeType: BUILD_GENERAL1_2XLARGE
        EnvironmentVariables:
          - Name: S2N_LIBCRYPTO
            Value: libressl
          - Name: BUILD_S2N
            Value: 'true'
          - Name: TESTS
            Value: integration
          - Name: GCC_VERSION
            Value: '9'
        Image: aws/codebuild/standard:4.0
        PrivilegedMode: true
        Type: LINUX_CONTAINER
      Name: s2nIntegrationLibreSSLGcc9
      ServiceRole: !Ref 's2nIntegrationLibreSSLGcc9Role'
      Source:
        BuildSpec: codebuild/spec/buildspec_ubuntu.yml
        GitCloneDepth: '1'
        Location: https://github.com/aws/s2n-tls.git
        ReportBuildStatus: true
        Type: GITHUB
      SourceVersion: ''
      TimeoutInMinutes: '90'
    Type: AWS::CodeBuild::Project
  s2nIntegrationLibreSSLGcc9Role:
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action:
              - sts:AssumeRole
            Effect: Allow
            Principal:
              Service:
                - codebuild.amazonaws.com
      Description: Policy created by CloudFormation.
      Path: /
      Policies:
        - PolicyDocument:
            Statement:
              - Action:
                  - s3:PutObject
                  - s3:GetObject
                  - s3:GetObjectVersion
                  - s3:GetBucketAcl
                  - s3:GetBucketLocation
                Effect: Allow
                Resource:
                  - arn:aws:s3:::s2n-build-artifacts/*
              - Action:
                  - logs:CreateLogGroup
                  - logs:CreateLogStream
                  - logs:PutLogEvents
                Effect: Allow
                Resource:
                  - arn:aws:logs:us-west-2:024603541914:log-group:/aws/codebuild/s2nIntegrationLibreSSLGcc9:*
              - Action:
                  - codecommit:BatchGet*
                  - codecommit:BatchDescribe*
                  - codecommit:Describe*
                  - codecommit:EvaluatePullRequestApprovalRules
                  - codecommit:Get*
                  - codecommit:List*
                  - codecommit:GitPull
                Effect: Allow
                Resource:
                  - '*'
          PolicyName: CodeBuildArtifactPolicy
    Type: AWS::IAM::Role
  s2nIntegrationLibreSSLGcc9Rule:
    DependsOn: s2nIntegrationLibreSSLGcc9
    Properties:
      Description: scheduled run Build with CloudFormation
      Name: s2nIntegrationLibreSSLGcc9Event
      ScheduleExpression: cron(0 12 * * ? *)
      State: ENABLED
      Targets:
        - Arn: !GetAtt 's2nIntegrationLibreSSLGcc9.Arn'
          Id: s2nIntegrationLibreSSLGcc9CWid
          RoleArn: !GetAtt 's2nEventsInvokeCodeBuildRole.Arn'
    Type: AWS::Events::Rule
  s2nIntegrationOpenSSL102Gcc6:
    DependsOn: s2nIntegrationOpenSSL102Gcc6Role
    Properties:
      Artifacts:
        Type: NO_ARTIFACTS
      BadgeEnabled: true
      Environment:
        ComputeType: BUILD_GENERAL1_2XLARGE
        EnvironmentVariables:
          - Name: S2N_LIBCRYPTO
            Value: openssl-1.0.2
          - Name: BUILD_S2N
            Value: 'true'
          - Name: TESTS
            Value: integration
          - Name: GCC_VERSION
            Value: '6'
        Image: aws/codebuild/standard:4.0
        PrivilegedMode: true
        Type: LINUX_CONTAINER
      Name: s2nIntegrationOpenSSL102Gcc6
      ServiceRole: !Ref 's2nIntegrationOpenSSL102Gcc6Role'
      Source:
        BuildSpec: codebuild/spec/buildspec_ubuntu.yml
        GitCloneDepth: '1'
        Location: https://github.com/aws/s2n-tls.git
        ReportBuildStatus: true
        Type: GITHUB
      SourceVersion: ''
      TimeoutInMinutes: '90'
    Type: AWS::CodeBuild::Project
  s2nIntegrationOpenSSL102Gcc6FIPS:
    DependsOn: s2nIntegrationOpenSSL102Gcc6FIPSRole
    Properties:
      Artifacts:
        Type: NO_ARTIFACTS
      BadgeEnabled: true
      Environment:
        ComputeType: BUILD_GENERAL1_2XLARGE
        EnvironmentVariables:
          - Name: S2N_LIBCRYPTO
            Value: openssl-1.0.2-fips
          - Name: BUILD_S2N
            Value: 'true'
          - Name: TESTS
            Value: integration
          - Name: GCC_VERSION
            Value: '6'
        Image: aws/codebuild/standard:4.0
        PrivilegedMode: true
        Type: LINUX_CONTAINER
      Name: s2nIntegrationOpenSSL102Gcc6FIPS
      ServiceRole: !Ref 's2nIntegrationOpenSSL102Gcc6FIPSRole'
      Source:
        BuildSpec: codebuild/spec/buildspec_ubuntu.yml
        GitCloneDepth: '1'
        Location: https://github.com/aws/s2n-tls.git
        ReportBuildStatus: true
        Type: GITHUB
      SourceVersion: ''
      TimeoutInMinutes: '90'
    Type: AWS::CodeBuild::Project
  s2nIntegrationOpenSSL102Gcc6FIPSRole:
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action:
              - sts:AssumeRole
            Effect: Allow
            Principal:
              Service:
                - codebuild.amazonaws.com
      Description: Policy created by CloudFormation.
      Path: /
      Policies:
        - PolicyDocument:
            Statement:
              - Action:
                  - s3:PutObject
                  - s3:GetObject
                  - s3:GetObjectVersion
                  - s3:GetBucketAcl
                  - s3:GetBucketLocation
                Effect: Allow
                Resource:
                  - arn:aws:s3:::s2n-build-artifacts/*
              - Action:
                  - logs:CreateLogGroup
                  - logs:CreateLogStream
                  - logs:PutLogEvents
                Effect: Allow
                Resource:
                  - arn:aws:logs:us-west-2:024603541914:log-group:/aws/codebuild/s2nIntegrationOpenSSL102Gcc6FIPS:*
              - Action:
                  - codecommit:BatchGet*
                  - codecommit:BatchDescribe*
                  - codecommit:Describe*
                  - codecommit:EvaluatePullRequestApprovalRules
                  - codecommit:Get*
                  - codecommit:List*
                  - codecommit:GitPull
                Effect: Allow
                Resource:
                  - '*'
          PolicyName: CodeBuildArtifactPolicy
    Type: AWS::IAM::Role
  s2nIntegrationOpenSSL102Gcc6FIPSRule:
    DependsOn: s2nIntegrationOpenSSL102Gcc6FIPS
    Properties:
      Description: scheduled run Build with CloudFormation
      Name: s2nIntegrationOpenSSL102Gcc6FIPSEvent
      ScheduleExpression: cron(0 12 * * ? *)
      State: ENABLED
      Targets:
        - Arn: !GetAtt 's2nIntegrationOpenSSL102Gcc6FIPS.Arn'
          Id: s2nIntegrationOpenSSL102Gcc6FIPSCWid
          RoleArn: !GetAtt 's2nEventsInvokeCodeBuildRole.Arn'
    Type: AWS::Events::Rule
  s2nIntegrationOpenSSL102Gcc6Role:
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action:
              - sts:AssumeRole
            Effect: Allow
            Principal:
              Service:
                - codebuild.amazonaws.com
      Description: Policy created by CloudFormation.
      Path: /
      Policies:
        - PolicyDocument:
            Statement:
              - Action:
                  - s3:PutObject
                  - s3:GetObject
                  - s3:GetObjectVersion
                  - s3:GetBucketAcl
                  - s3:GetBucketLocation
                Effect: Allow
                Resource:
                  - arn:aws:s3:::s2n-build-artifacts/*
              - Action:
                  - logs:CreateLogGroup
                  - logs:CreateLogStream
                  - logs:PutLogEvents
                Effect: Allow
                Resource:
                  - arn:aws:logs:us-west-2:024603541914:log-group:/aws/codebuild/s2nIntegrationOpenSSL102Gcc6:*
              - Action:
                  - codecommit:BatchGet*
                  - codecommit:BatchDescribe*
                  - codecommit:Describe*
                  - codecommit:EvaluatePullRequestApprovalRules
                  - codecommit:Get*
                  - codecommit:List*
                  - codecommit:GitPull
                Effect: Allow
                Resource:
                  - '*'
          PolicyName: CodeBuildArtifactPolicy
    Type: AWS::IAM::Role
  s2nIntegrationOpenSSL102Gcc6Rule:
    DependsOn: s2nIntegrationOpenSSL102Gcc6
    Properties:
      Description: scheduled run Build with CloudFormation
      Name: s2nIntegrationOpenSSL102Gcc6Event
      ScheduleExpression: cron(0 12 * * ? *)
      State: ENABLED
      Targets:
        - Arn: !GetAtt 's2nIntegrationOpenSSL102Gcc6.Arn'
          Id: s2nIntegrationOpenSSL102Gcc6CWid
          RoleArn: !GetAtt 's2nEventsInvokeCodeBuildRole.Arn'
    Type: AWS::Events::Rule
  s2nIntegrationOpenSSL111Gcc6Corked:
    DependsOn: s2nIntegrationOpenSSL111Gcc6CorkedRole
    Properties:
      Artifacts:
        Type: NO_ARTIFACTS
      BadgeEnabled: true
      Environment:
        ComputeType: BUILD_GENERAL1_2XLARGE
        EnvironmentVariables:
          - Name: S2N_LIBCRYPTO
            Value: openssl-1.1.1
          - Name: BUILD_S2N
            Value: 'true'
          - Name: TESTS
            Value: integration
          - Name: GCC_VERSION
            Value: '6'
          - Name: S2N_CORKED_IO
            Value: 'true'
        Image: aws/codebuild/standard:4.0
        PrivilegedMode: true
        Type: LINUX_CONTAINER
      Name: s2nIntegrationOpenSSL111Gcc6Corked
      ServiceRole: !Ref 's2nIntegrationOpenSSL111Gcc6CorkedRole'
      Source:
        BuildSpec: codebuild/spec/buildspec_ubuntu.yml
        GitCloneDepth: '1'
        Location: https://github.com/aws/s2n-tls.git
        ReportBuildStatus: true
        Type: GITHUB
      SourceVersion: ''
      TimeoutInMinutes: '90'
    Type: AWS::CodeBuild::Project
  s2nIntegrationOpenSSL111Gcc6CorkedRole:
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action:
              - sts:AssumeRole
            Effect: Allow
            Principal:
              Service:
                - codebuild.amazonaws.com
      Description: Policy created by CloudFormation.
      Path: /
      Policies:
        - PolicyDocument:
            Statement:
              - Action:
                  - s3:PutObject
                  - s3:GetObject
                  - s3:GetObjectVersion
                  - s3:GetBucketAcl
                  - s3:GetBucketLocation
                Effect: Allow
                Resource:
                  - arn:aws:s3:::s2n-build-artifacts/*
              - Action:
                  - logs:CreateLogGroup
                  - logs:CreateLogStream
                  - logs:PutLogEvents
                Effect: Allow
                Resource:
                  - arn:aws:logs:us-west-2:024603541914:log-group:/aws/codebuild/s2nIntegrationOpenSSL111Gcc6Corked:*
              - Action:
                  - codecommit:BatchGet*
                  - codecommit:BatchDescribe*
                  - codecommit:Describe*
                  - codecommit:EvaluatePullRequestApprovalRules
                  - codecommit:Get*
                  - codecommit:List*
                  - codecommit:GitPull
                Effect: Allow
                Resource:
                  - '*'
          PolicyName: CodeBuildArtifactPolicy
    Type: AWS::IAM::Role
  s2nIntegrationOpenSSL111Gcc6CorkedRule:
    DependsOn: s2nIntegrationOpenSSL111Gcc6Corked
    Properties:
      Description: scheduled run Build with CloudFormation
      Name: s2nIntegrationOpenSSL111Gcc6CorkedEvent
      ScheduleExpression: cron(0 12 * * ? *)
      State: ENABLED
      Targets:
        - Arn: !GetAtt 's2nIntegrationOpenSSL111Gcc6Corked.Arn'
          Id: s2nIntegrationOpenSSL111Gcc6CorkedCWid
          RoleArn: !GetAtt 's2nEventsInvokeCodeBuildRole.Arn'
    Type: AWS::Events::Rule
  s2nIntegrationOpenSSL111Gcc6Coverage:
    DependsOn: s2nIntegrationOpenSSL111Gcc6CoverageRole
    Properties:
      Artifacts:
        Type: NO_ARTIFACTS
      BadgeEnabled: true
      Environment:
        ComputeType: BUILD_GENERAL1_2XLARGE
        EnvironmentVariables:
          - Name: S2N_LIBCRYPTO
            Value: openssl-1.1.1
          - Name: BUILD_S2N
            Value: 'true'
          - Name: TESTS
            Value: integration
          - Name: GCC_VERSION
            Value: '6'
          - Name: S2N_COVERAGE
            Value: 'true'
          - Name: CODECOV_IO_UPLOAD
            Value: 'true'
        Image: aws/codebuild/standard:4.0
        PrivilegedMode: true
        Type: LINUX_CONTAINER
      Name: s2nIntegrationOpenSSL111Gcc6Coverage
      ServiceRole: !Ref 's2nIntegrationOpenSSL111Gcc6CoverageRole'
      Source:
        BuildSpec: codebuild/spec/buildspec_ubuntu.yml
        GitCloneDepth: '1'
        Location: https://github.com/aws/s2n-tls.git
        ReportBuildStatus: true
        Type: GITHUB
      SourceVersion: ''
      TimeoutInMinutes: '90'
    Type: AWS::CodeBuild::Project
  s2nIntegrationOpenSSL111Gcc6CoverageRole:
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action:
              - sts:AssumeRole
            Effect: Allow
            Principal:
              Service:
                - codebuild.amazonaws.com
      Description: Policy created by CloudFormation.
      Path: /
      Policies:
        - PolicyDocument:
            Statement:
              - Action:
                  - s3:PutObject
                  - s3:GetObject
                  - s3:GetObjectVersion
                  - s3:GetBucketAcl
                  - s3:GetBucketLocation
                Effect: Allow
                Resource:
                  - arn:aws:s3:::s2n-build-artifacts/*
              - Action:
                  - logs:CreateLogGroup
                  - logs:CreateLogStream
                  - logs:PutLogEvents
                Effect: Allow
                Resource:
                  - arn:aws:logs:us-west-2:024603541914:log-group:/aws/codebuild/s2nIntegrationOpenSSL111Gcc6Coverage:*
              - Action:
                  - codecommit:BatchGet*
                  - codecommit:BatchDescribe*
                  - codecommit:Describe*
                  - codecommit:EvaluatePullRequestApprovalRules
                  - codecommit:Get*
                  - codecommit:List*
                  - codecommit:GitPull
                Effect: Allow
                Resource:
                  - '*'
          PolicyName: CodeBuildArtifactPolicy
    Type: AWS::IAM::Role
  s2nIntegrationOpenSSL111Gcc6CoverageRule:
    DependsOn: s2nIntegrationOpenSSL111Gcc6Coverage
    Properties:
      Description: scheduled run Build with CloudFormation
      Name: s2nIntegrationOpenSSL111Gcc6CoverageEvent
      ScheduleExpression: cron(0 12 * * ? *)
      State: ENABLED
      Targets:
        - Arn: !GetAtt 's2nIntegrationOpenSSL111Gcc6Coverage.Arn'
          Id: s2nIntegrationOpenSSL111Gcc6CoverageCWid
          RoleArn: !GetAtt 's2nEventsInvokeCodeBuildRole.Arn'
    Type: AWS::Events::Rule
  s2nIntegrationOpenSSL111Gcc6SoftCrypto:
    DependsOn: s2nIntegrationOpenSSL111Gcc6SoftCryptoRole
    Properties:
      Artifacts:
        Type: NO_ARTIFACTS
      BadgeEnabled: true
      Environment:
        ComputeType: BUILD_GENERAL1_2XLARGE
        EnvironmentVariables:
          - Name: S2N_LIBCRYPTO
            Value: openssl-1.1.1
          - Name: OPENSSL_ia32cap
            Value: '"~0x200000200000000"'
          - Name: BUILD_S2N
            Value: 'true'
          - Name: TESTS
            Value: integration
          - Name: GCC_VERSION
            Value: '6'
        Image: aws/codebuild/standard:4.0
        PrivilegedMode: true
        Type: LINUX_CONTAINER
      Name: s2nIntegrationOpenSSL111Gcc6SoftCrypto
      ServiceRole: !Ref 's2nIntegrationOpenSSL111Gcc6SoftCryptoRole'
      Source:
        BuildSpec: codebuild/spec/buildspec_ubuntu.yml
        GitCloneDepth: '1'
        Location: https://github.com/aws/s2n-tls.git
        ReportBuildStatus: true
        Type: GITHUB
      SourceVersion: ''
      TimeoutInMinutes: '90'
    Type: AWS::CodeBuild::Project
  s2nIntegrationOpenSSL111Gcc6SoftCryptoRole:
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action:
              - sts:AssumeRole
            Effect: Allow
            Principal:
              Service:
                - codebuild.amazonaws.com
      Description: Policy created by CloudFormation.
      Path: /
      Policies:
        - PolicyDocument:
            Statement:
              - Action:
                  - s3:PutObject
                  - s3:GetObject
                  - s3:GetObjectVersion
                  - s3:GetBucketAcl
                  - s3:GetBucketLocation
                Effect: Allow
                Resource:
                  - arn:aws:s3:::s2n-build-artifacts/*
              - Action:
                  - logs:CreateLogGroup
                  - logs:CreateLogStream
                  - logs:PutLogEvents
                Effect: Allow
                Resource:
                  - arn:aws:logs:us-west-2:024603541914:log-group:/aws/codebuild/s2nIntegrationOpenSSL111Gcc6SoftCrypto:*
              - Action:
                  - codecommit:BatchGet*
                  - codecommit:BatchDescribe*
                  - codecommit:Describe*
                  - codecommit:EvaluatePullRequestApprovalRules
                  - codecommit:Get*
                  - codecommit:List*
                  - codecommit:GitPull
                Effect: Allow
                Resource:
                  - '*'
          PolicyName: CodeBuildArtifactPolicy
    Type: AWS::IAM::Role
  s2nIntegrationOpenSSL111Gcc6SoftCryptoRule:
    DependsOn: s2nIntegrationOpenSSL111Gcc6SoftCrypto
    Properties:
      Description: scheduled run Build with CloudFormation
      Name: s2nIntegrationOpenSSL111Gcc6SoftCryptoEvent
      ScheduleExpression: cron(0 12 * * ? *)
      State: ENABLED
      Targets:
        - Arn: !GetAtt 's2nIntegrationOpenSSL111Gcc6SoftCrypto.Arn'
          Id: s2nIntegrationOpenSSL111Gcc6SoftCryptoCWid
          RoleArn: !GetAtt 's2nEventsInvokeCodeBuildRole.Arn'
    Type: AWS::Events::Rule
  s2nIntegrationOpenSSL111Gcc9:
    DependsOn: s2nIntegrationOpenSSL111Gcc9Role
    Properties:
      Artifacts:
        Type: NO_ARTIFACTS
      BadgeEnabled: true
      Environment:
        ComputeType: BUILD_GENERAL1_2XLARGE
        EnvironmentVariables:
          - Name: S2N_LIBCRYPTO
            Value: openssl-1.1.1
          - Name: BUILD_S2N
            Value: 'true'
          - Name: TESTS
            Value: integration
          - Name: GCC_VERSION
            Value: '9'
        Image: aws/codebuild/standard:4.0
        PrivilegedMode: true
        Type: LINUX_CONTAINER
      Name: s2nIntegrationOpenSSL111Gcc9
      ServiceRole: !Ref 's2nIntegrationOpenSSL111Gcc9Role'
      Source:
        BuildSpec: codebuild/spec/buildspec_ubuntu.yml
        GitCloneDepth: '1'
        Location: https://github.com/aws/s2n-tls.git
        ReportBuildStatus: true
        Type: GITHUB
      SourceVersion: ''
      TimeoutInMinutes: '90'
    Type: AWS::CodeBuild::Project
  s2nIntegrationOpenSSL111Gcc9Role:
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action:
              - sts:AssumeRole
            Effect: Allow
            Principal:
              Service:
                - codebuild.amazonaws.com
      Description: Policy created by CloudFormation.
      Path: /
      Policies:
        - PolicyDocument:
            Statement:
              - Action:
                  - s3:PutObject
                  - s3:GetObject
                  - s3:GetObjectVersion
                  - s3:GetBucketAcl
                  - s3:GetBucketLocation
                Effect: Allow
                Resource:
                  - arn:aws:s3:::s2n-build-artifacts/*
              - Action:
                  - logs:CreateLogGroup
                  - logs:CreateLogStream
                  - logs:PutLogEvents
                Effect: Allow
                Resource:
                  - arn:aws:logs:us-west-2:024603541914:log-group:/aws/codebuild/s2nIntegrationOpenSSL111Gcc9:*
              - Action:
                  - codecommit:BatchGet*
                  - codecommit:BatchDescribe*
                  - codecommit:Describe*
                  - codecommit:EvaluatePullRequestApprovalRules
                  - codecommit:Get*
                  - codecommit:List*
                  - codecommit:GitPull
                Effect: Allow
                Resource:
                  - '*'
          PolicyName: CodeBuildArtifactPolicy
    Type: AWS::IAM::Role
  s2nIntegrationOpenSSL111Gcc9Rule:
    DependsOn: s2nIntegrationOpenSSL111Gcc9
    Properties:
      Description: scheduled run Build with CloudFormation
      Name: s2nIntegrationOpenSSL111Gcc9Event
      ScheduleExpression: cron(0 12 * * ? *)
      State: ENABLED
      Targets:
        - Arn: !GetAtt 's2nIntegrationOpenSSL111Gcc9.Arn'
          Id: s2nIntegrationOpenSSL111Gcc9CWid
          RoleArn: !GetAtt 's2nEventsInvokeCodeBuildRole.Arn'
    Type: AWS::Events::Rule
  s2nSawBike:
    DependsOn: s2nSawBikeRole
    Properties:
      Artifacts:
        Type: NO_ARTIFACTS
      BadgeEnabled: true
      Environment:
        ComputeType: BUILD_GENERAL1_2XLARGE
        EnvironmentVariables:
          - Name: TESTS
            Value: sawBIKE
          - Name: SAW
            Value: 'true'
          - Name: GCC_VERSION
            Value: NONE
          - Name: S2N_LIBCRYPTO
            Value: openssl-1.0.2
        Image: aws/codebuild/standard:4.0
        PrivilegedMode: true
        Type: LINUX_CONTAINER
      Name: s2nSawBike
      ServiceRole: !Ref 's2nSawBikeRole'
      Source:
        BuildSpec: codebuild/spec/buildspec_ubuntu.yml
        GitCloneDepth: '1'
        Location: https://github.com/aws/s2n-tls.git
        ReportBuildStatus: true
        Type: GITHUB
      SourceVersion: ''
      TimeoutInMinutes: '90'
    Type: AWS::CodeBuild::Project
  s2nSawBikeRole:
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action:
              - sts:AssumeRole
            Effect: Allow
            Principal:
              Service:
                - codebuild.amazonaws.com
      Description: Policy created by CloudFormation.
      Path: /
      Policies:
        - PolicyDocument:
            Statement:
              - Action:
                  - s3:PutObject
                  - s3:GetObject
                  - s3:GetObjectVersion
                  - s3:GetBucketAcl
                  - s3:GetBucketLocation
                Effect: Allow
                Resource:
                  - arn:aws:s3:::s2n-build-artifacts/*
              - Action:
                  - logs:CreateLogGroup
                  - logs:CreateLogStream
                  - logs:PutLogEvents
                Effect: Allow
                Resource:
                  - arn:aws:logs:us-west-2:024603541914:log-group:/aws/codebuild/s2nSawBike:*
              - Action:
                  - codecommit:BatchGet*
                  - codecommit:BatchDescribe*
                  - codecommit:Describe*
                  - codecommit:EvaluatePullRequestApprovalRules
                  - codecommit:Get*
                  - codecommit:List*
                  - codecommit:GitPull
                Effect: Allow
                Resource:
                  - '*'
          PolicyName: CodeBuildArtifactPolicy
    Type: AWS::IAM::Role
  s2nSawBikeRule:
    DependsOn: s2nSawBike
    Properties:
      Description: scheduled run Build with CloudFormation
      Name: s2nSawBikeEvent
      ScheduleExpression: cron(0 12 * * ? *)
      State: ENABLED
      Targets:
        - Arn: !GetAtt 's2nSawBike.Arn'
          Id: s2nSawBikeCWid
          RoleArn: !GetAtt 's2nEventsInvokeCodeBuildRole.Arn'
    Type: AWS::Events::Rule
  s2nSawHmacPlus:
    DependsOn: s2nSawHmacPlusRole
    Properties:
      Artifacts:
        Type: NO_ARTIFACTS
      BadgeEnabled: true
      Environment:
        ComputeType: BUILD_GENERAL1_LARGE
        EnvironmentVariables:
          - Name: TESTS
            Value: sawHMACPlus
          - Name: SAW
            Value: 'true'
          - Name: GCC_VERSION
            Value: NONE
        Image: aws/codebuild/standard:4.0
        PrivilegedMode: true
        Type: LINUX_CONTAINER
      Name: s2nSawHmacPlus
      ServiceRole: !Ref 's2nSawHmacPlusRole'
      Source:
        BuildSpec: codebuild/spec/buildspec_ubuntu.yml
        GitCloneDepth: '1'
        Location: https://github.com/aws/s2n-tls.git
        ReportBuildStatus: true
        Type: GITHUB
      SourceVersion: ''
      TimeoutInMinutes: '90'
    Type: AWS::CodeBuild::Project
  s2nSawHmacPlusRole:
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action:
              - sts:AssumeRole
            Effect: Allow
            Principal:
              Service:
                - codebuild.amazonaws.com
      Description: Policy created by CloudFormation.
      Path: /
      Policies:
        - PolicyDocument:
            Statement:
              - Action:
                  - s3:PutObject
                  - s3:GetObject
                  - s3:GetObjectVersion
                  - s3:GetBucketAcl
                  - s3:GetBucketLocation
                Effect: Allow
                Resource:
                  - arn:aws:s3:::s2n-build-artifacts/*
              - Action:
                  - logs:CreateLogGroup
                  - logs:CreateLogStream
                  - logs:PutLogEvents
                Effect: Allow
                Resource:
                  - arn:aws:logs:us-west-2:024603541914:log-group:/aws/codebuild/s2nSawHmacPlus:*
              - Action:
                  - codecommit:BatchGet*
                  - codecommit:BatchDescribe*
                  - codecommit:Describe*
                  - codecommit:EvaluatePullRequestApprovalRules
                  - codecommit:Get*
                  - codecommit:List*
                  - codecommit:GitPull
                Effect: Allow
                Resource:
                  - '*'
          PolicyName: CodeBuildArtifactPolicy
    Type: AWS::IAM::Role
  s2nSawHmacPlusRule:
    DependsOn: s2nSawHmacPlus
    Properties:
      Description: scheduled run Build with CloudFormation
      Name: s2nSawHmacPlusEvent
      ScheduleExpression: cron(0 12 * * ? *)
      State: ENABLED
      Targets:
        - Arn: !GetAtt 's2nSawHmacPlus.Arn'
          Id: s2nSawHmacPlusCWid
          RoleArn: !GetAtt 's2nEventsInvokeCodeBuildRole.Arn'
    Type: AWS::Events::Rule
  s2nSawTls:
    DependsOn: s2nSawTlsRole
    Properties:
      Artifacts:
        Type: NO_ARTIFACTS
      BadgeEnabled: true
      Environment:
        ComputeType: BUILD_GENERAL1_2XLARGE
        EnvironmentVariables:
          - Name: TESTS
            Value: tls
          - Name: SAW
            Value: 'true'
          - Name: GCC_VERSION
            Value: NONE
        Image: aws/codebuild/standard:4.0
        PrivilegedMode: true
        Type: LINUX_CONTAINER
      Name: s2nSawTls
      ServiceRole: !Ref 's2nSawTlsRole'
      Source:
        BuildSpec: codebuild/spec/buildspec_ubuntu.yml
        GitCloneDepth: '1'
        Location: https://github.com/aws/s2n-tls.git
        ReportBuildStatus: true
        Type: GITHUB
      SourceVersion: ''
      TimeoutInMinutes: '90'
    Type: AWS::CodeBuild::Project
  s2nSawTlsRole:
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action:
              - sts:AssumeRole
            Effect: Allow
            Principal:
              Service:
                - codebuild.amazonaws.com
      Description: Policy created by CloudFormation.
      Path: /
      Policies:
        - PolicyDocument:
            Statement:
              - Action:
                  - s3:PutObject
                  - s3:GetObject
                  - s3:GetObjectVersion
                  - s3:GetBucketAcl
                  - s3:GetBucketLocation
                Effect: Allow
                Resource:
                  - arn:aws:s3:::s2n-build-artifacts/*
              - Action:
                  - logs:CreateLogGroup
                  - logs:CreateLogStream
                  - logs:PutLogEvents
                Effect: Allow
                Resource:
                  - arn:aws:logs:us-west-2:024603541914:log-group:/aws/codebuild/s2nSawTls:*
              - Action:
                  - codecommit:BatchGet*
                  - codecommit:BatchDescribe*
                  - codecommit:Describe*
                  - codecommit:EvaluatePullRequestApprovalRules
                  - codecommit:Get*
                  - codecommit:List*
                  - codecommit:GitPull
                Effect: Allow
                Resource:
                  - '*'
          PolicyName: CodeBuildArtifactPolicy
    Type: AWS::IAM::Role
  s2nSawTlsRule:
    DependsOn: s2nSawTls
    Properties:
      Description: scheduled run Build with CloudFormation
      Name: s2nSawTlsEvent
      ScheduleExpression: cron(0 12 * * ? *)
      State: ENABLED
      Targets:
        - Arn: !GetAtt 's2nSawTls.Arn'
          Id: s2nSawTlsCWid
          RoleArn: !GetAtt 's2nEventsInvokeCodeBuildRole.Arn'
    Type: AWS::Events::Rule
  s2nSidetrail:
    DependsOn: s2nSidetrailRole
    Properties:
      Artifacts:
        Type: NO_ARTIFACTS
      BadgeEnabled: true
      Environment:
        ComputeType: BUILD_GENERAL1_2XLARGE
        EnvironmentVariables:
          - Name: TESTS
            Value: sidetrail
        Image: '024603541914.dkr.ecr.us-west-2.amazonaws.com/linux-docker-images:sidetrail'
        PrivilegedMode: true
        Type: LINUX_CONTAINER
      Name: s2nSidetrail
      ServiceRole: !Ref 's2nSidetrailRole'
      Source:
        BuildSpec: codebuild/spec/buildspec_sidetrail.yml
        GitCloneDepth: '1'
        Location: https://github.com/aws/s2n-tls.git
        ReportBuildStatus: true
        Type: GITHUB
      SourceVersion: ''
      TimeoutInMinutes: '90'
    Type: AWS::CodeBuild::Project
  s2nSidetrailRole:
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action:
              - sts:AssumeRole
            Effect: Allow
            Principal:
              Service:
                - codebuild.amazonaws.com
      Description: Policy created by CloudFormation.
      Path: /
      Policies:
        - PolicyDocument:
            Statement:
              - Action:
                  - s3:PutObject
                  - s3:GetObject
                  - s3:GetObjectVersion
                  - s3:GetBucketAcl
                  - s3:GetBucketLocation
                Effect: Allow
                Resource:
                  - arn:aws:s3:::s2n-build-artifacts/*
              - Action:
                  - logs:CreateLogGroup
                  - logs:CreateLogStream
                  - logs:PutLogEvents
                Effect: Allow
                Resource:
                  - arn:aws:logs:us-west-2:024603541914:log-group:/aws/codebuild/s2nSidetrail:*
              - Action:
                  - codecommit:BatchGet*
                  - codecommit:BatchDescribe*
                  - codecommit:Describe*
                  - codecommit:EvaluatePullRequestApprovalRules
                  - codecommit:Get*
                  - codecommit:List*
                  - codecommit:GitPull
                Effect: Allow
                Resource:
                  - '*'
          PolicyName: CodeBuildArtifactPolicy
    Type: AWS::IAM::Role
  s2nSidetrailRule:
    DependsOn: s2nSidetrail
    Properties:
      Description: scheduled run Build with CloudFormation
      Name: s2nSidetrailEvent
      ScheduleExpression: cron(0 12 * * ? *)
      State: ENABLED
      Targets:
        - Arn: !GetAtt 's2nSidetrail.Arn'
          Id: s2nSidetrailCWid
          RoleArn: !GetAtt 's2nEventsInvokeCodeBuildRole.Arn'
    Type: AWS::Events::Rule
  s2nValgrindOpenSSL102Gcc6:
    DependsOn: s2nValgrindOpenSSL102Gcc6Role
    Properties:
      Artifacts:
        Type: NO_ARTIFACTS
      BadgeEnabled: true
      Environment:
        ComputeType: BUILD_GENERAL1_2XLARGE
        EnvironmentVariables:
          - Name: S2N_LIBCRYPTO
            Value: openssl-1.0.2
          - Name: BUILD_S2N
            Value: 'true'
          - Name: TESTS
            Value: valgrind
          - Name: GCC_VERSION
            Value: '6'
        Image: aws/codebuild/standard:4.0
        PrivilegedMode: true
        Type: LINUX_CONTAINER
      Name: s2nValgrindOpenSSL102Gcc6
      ServiceRole: !Ref 's2nValgrindOpenSSL102Gcc6Role'
      Source:
        BuildSpec: codebuild/spec/buildspec_ubuntu.yml
        GitCloneDepth: '1'
        Location: https://github.com/aws/s2n-tls.git
        ReportBuildStatus: true
        Type: GITHUB
      SourceVersion: ''
      TimeoutInMinutes: '90'
    Type: AWS::CodeBuild::Project
  s2nValgrindOpenSSL102Gcc6Fips:
    DependsOn: s2nValgrindOpenSSL102Gcc6FipsRole
    Properties:
      Artifacts:
        Type: NO_ARTIFACTS
      BadgeEnabled: true
      Environment:
        ComputeType: BUILD_GENERAL1_2XLARGE
        EnvironmentVariables:
          - Name: S2N_LIBCRYPTO
            Value: openssl-1.0.2-fips
          - Name: BUILD_S2N
            Value: 'true'
          - Name: TESTS
            Value: valgrind
          - Name: GCC_VERSION
            Value: '6'
        Image: aws/codebuild/standard:4.0
        PrivilegedMode: true
        Type: LINUX_CONTAINER
      Name: s2nValgrindOpenSSL102Gcc6Fips
      ServiceRole: !Ref 's2nValgrindOpenSSL102Gcc6FipsRole'
      Source:
        BuildSpec: codebuild/spec/buildspec_ubuntu.yml
        GitCloneDepth: '1'
        Location: https://github.com/aws/s2n-tls.git
        ReportBuildStatus: true
        Type: GITHUB
      SourceVersion: ''
      TimeoutInMinutes: '90'
    Type: AWS::CodeBuild::Project
  s2nValgrindOpenSSL102Gcc6FipsRole:
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action:
              - sts:AssumeRole
            Effect: Allow
            Principal:
              Service:
                - codebuild.amazonaws.com
      Description: Policy created by CloudFormation.
      Path: /
      Policies:
        - PolicyDocument:
            Statement:
              - Action:
                  - s3:PutObject
                  - s3:GetObject
                  - s3:GetObjectVersion
                  - s3:GetBucketAcl
                  - s3:GetBucketLocation
                Effect: Allow
                Resource:
                  - arn:aws:s3:::s2n-build-artifacts/*
              - Action:
                  - logs:CreateLogGroup
                  - logs:CreateLogStream
                  - logs:PutLogEvents
                Effect: Allow
                Resource:
                  - arn:aws:logs:us-west-2:024603541914:log-group:/aws/codebuild/s2nValgrindOpenSSL102Gcc6Fips:*
              - Action:
                  - codecommit:BatchGet*
                  - codecommit:BatchDescribe*
                  - codecommit:Describe*
                  - codecommit:EvaluatePullRequestApprovalRules
                  - codecommit:Get*
                  - codecommit:List*
                  - codecommit:GitPull
                Effect: Allow
                Resource:
                  - '*'
          PolicyName: CodeBuildArtifactPolicy
    Type: AWS::IAM::Role
  s2nValgrindOpenSSL102Gcc6FipsRule:
    DependsOn: s2nValgrindOpenSSL102Gcc6Fips
    Properties:
      Description: scheduled run Build with CloudFormation
      Name: s2nValgrindOpenSSL102Gcc6FipsEvent
      ScheduleExpression: cron(0 12 * * ? *)
      State: ENABLED
      Targets:
        - Arn: !GetAtt 's2nValgrindOpenSSL102Gcc6Fips.Arn'
          Id: s2nValgrindOpenSSL102Gcc6FipsCWid
          RoleArn: !GetAtt 's2nEventsInvokeCodeBuildRole.Arn'
    Type: AWS::Events::Rule
  s2nValgrindOpenSSL102Gcc6Role:
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action:
              - sts:AssumeRole
            Effect: Allow
            Principal:
              Service:
                - codebuild.amazonaws.com
      Description: Policy created by CloudFormation.
      Path: /
      Policies:
        - PolicyDocument:
            Statement:
              - Action:
                  - s3:PutObject
                  - s3:GetObject
                  - s3:GetObjectVersion
                  - s3:GetBucketAcl
                  - s3:GetBucketLocation
                Effect: Allow
                Resource:
                  - arn:aws:s3:::s2n-build-artifacts/*
              - Action:
                  - logs:CreateLogGroup
                  - logs:CreateLogStream
                  - logs:PutLogEvents
                Effect: Allow
                Resource:
                  - arn:aws:logs:us-west-2:024603541914:log-group:/aws/codebuild/s2nValgrindOpenSSL102Gcc6:*
              - Action:
                  - codecommit:BatchGet*
                  - codecommit:BatchDescribe*
                  - codecommit:Describe*
                  - codecommit:EvaluatePullRequestApprovalRules
                  - codecommit:Get*
                  - codecommit:List*
                  - codecommit:GitPull
                Effect: Allow
                Resource:
                  - '*'
          PolicyName: CodeBuildArtifactPolicy
    Type: AWS::IAM::Role
  s2nValgrindOpenSSL102Gcc6Rule:
    DependsOn: s2nValgrindOpenSSL102Gcc6
    Properties:
      Description: scheduled run Build with CloudFormation
      Name: s2nValgrindOpenSSL102Gcc6Event
      ScheduleExpression: cron(0 12 * * ? *)
      State: ENABLED
      Targets:
        - Arn: !GetAtt 's2nValgrindOpenSSL102Gcc6.Arn'
          Id: s2nValgrindOpenSSL102Gcc6CWid
          RoleArn: !GetAtt 's2nEventsInvokeCodeBuildRole.Arn'
    Type: AWS::Events::Rule
  s2nValgrindOpenSSL111Gcc9:
    DependsOn: s2nValgrindOpenSSL111Gcc9Role
    Properties:
      Artifacts:
        Type: NO_ARTIFACTS
      BadgeEnabled: true
      Environment:
        ComputeType: BUILD_GENERAL1_2XLARGE
        EnvironmentVariables:
          - Name: S2N_LIBCRYPTO
            Value: openssl-1.1.1
          - Name: BUILD_S2N
            Value: 'true'
          - Name: TESTS
            Value: valgrind
          - Name: GCC_VERSION
            Value: '9'
        Image: aws/codebuild/standard:4.0
        PrivilegedMode: true
        Type: LINUX_CONTAINER
      Name: s2nValgrindOpenSSL111Gcc9
      ServiceRole: !Ref 's2nValgrindOpenSSL111Gcc9Role'
      Source:
        BuildSpec: codebuild/spec/buildspec_ubuntu.yml
        GitCloneDepth: '1'
        Location: https://github.com/aws/s2n-tls.git
        ReportBuildStatus: true
        Type: GITHUB
      SourceVersion: ''
      TimeoutInMinutes: '90'
    Type: AWS::CodeBuild::Project
  s2nValgrindOpenSSL111Gcc9Role:
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action:
              - sts:AssumeRole
            Effect: Allow
            Principal:
              Service:
                - codebuild.amazonaws.com
      Description: Policy created by CloudFormation.
      Path: /
      Policies:
        - PolicyDocument:
            Statement:
              - Action:
                  - s3:PutObject
                  - s3:GetObject
                  - s3:GetObjectVersion
                  - s3:GetBucketAcl
                  - s3:GetBucketLocation
                Effect: Allow
                Resource:
                  - arn:aws:s3:::s2n-build-artifacts/*
              - Action:
                  - logs:CreateLogGroup
                  - logs:CreateLogStream
                  - logs:PutLogEvents
                Effect: Allow
                Resource:
                  - arn:aws:logs:us-west-2:024603541914:log-group:/aws/codebuild/s2nValgrindOpenSSL111Gcc9:*
              - Action:
                  - codecommit:BatchGet*
                  - codecommit:BatchDescribe*
                  - codecommit:Describe*
                  - codecommit:EvaluatePullRequestApprovalRules
                  - codecommit:Get*
                  - codecommit:List*
                  - codecommit:GitPull
                Effect: Allow
                Resource:
                  - '*'
          PolicyName: CodeBuildArtifactPolicy
    Type: AWS::IAM::Role
  s2nValgrindOpenSSL111Gcc9Rule:
    DependsOn: s2nValgrindOpenSSL111Gcc9
    Properties:
      Description: scheduled run Build with CloudFormation
      Name: s2nValgrindOpenSSL111Gcc9Event
      ScheduleExpression: cron(0 12 * * ? *)
      State: ENABLED
      Targets:
        - Arn: !GetAtt 's2nValgrindOpenSSL111Gcc9.Arn'
          Id: s2nValgrindOpenSSL111Gcc9CWid
          RoleArn: !GetAtt 's2nEventsInvokeCodeBuildRole.Arn'
    Type: AWS::Events::Rule
  s2nfuzzerOpenSSL102FIPS:
    DependsOn: s2nfuzzerOpenSSL102FIPSRole
    Properties:
      Artifacts:
        ArtifactIdentifier: s2nfuzzerOpenSSL102FIPS
        EncryptionDisabled: true
        Location: s2n-build-artifacts
        Name: s2nfuzzerOpenSSL102FIPSArtifact
        NamespaceType: NONE
        OverrideArtifactName: false
        Packaging: ZIP
        Type: S3
      BadgeEnabled: true
      Environment:
        ComputeType: BUILD_GENERAL1_LARGE
        EnvironmentVariables:
          - Name: S2N_LIBCRYPTO
            Value: openssl-1.0.2-fips
          - Name: LATEST_CLANG
            Value: 'true'
          - Name: TESTS
            Value: fuzz
          - Name: FUZZ_TIMEOUT_SEC
            Value: '60'
        Image: aws/codebuild/standard:5.0
        PrivilegedMode: true
        Type: LINUX_CONTAINER
      Name: s2nfuzzerOpenSSL102FIPS
      SecondaryArtifacts:
        - ArtifactIdentifier: logs
          EncryptionDisabled: true
          Location: s2n-build-artifacts
          Name: logsArtifact
          NamespaceType: NONE
          OverrideArtifactName: false
          Packaging: ZIP
          Type: S3
      ServiceRole: !Ref 's2nfuzzerOpenSSL102FIPSRole'
      Source:
        BuildSpec: codebuild/spec/buildspec_ubuntu_fuzz_artifacts.yml
        GitCloneDepth: '1'
        Location: https://github.com/awslabs/private-s2n-fuzz.git
        ReportBuildStatus: true
        Type: GITHUB
      SourceVersion: ''
      TimeoutInMinutes: '480'
    Type: AWS::CodeBuild::Project
  s2nfuzzerOpenSSL102FIPSRole:
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action:
              - sts:AssumeRole
            Effect: Allow
            Principal:
              Service:
                - codebuild.amazonaws.com
      Description: Policy created by CloudFormation.
      Path: /
      Policies:
        - PolicyDocument:
            Statement:
              - Action:
                  - s3:PutObject
                  - s3:GetObject
                  - s3:GetObjectVersion
                  - s3:GetBucketAcl
                  - s3:GetBucketLocation
                Effect: Allow
                Resource:
                  - arn:aws:s3:::s2n-build-artifacts/*
              - Action:
                  - logs:CreateLogGroup
                  - logs:CreateLogStream
                  - logs:PutLogEvents
                Effect: Allow
                Resource:
                  - arn:aws:logs:us-west-2:024603541914:log-group:/aws/codebuild/s2nfuzzerOpenSSL102FIPS:*
              - Action:
                  - codecommit:BatchGet*
                  - codecommit:BatchDescribe*
                  - codecommit:Describe*
                  - codecommit:EvaluatePullRequestApprovalRules
                  - codecommit:Get*
                  - codecommit:List*
                  - codecommit:GitPull
                Effect: Allow
                Resource:
                  - '*'
          PolicyName: CodeBuildArtifactPolicy
    Type: AWS::IAM::Role
  s2nfuzzerOpenSSL102FIPSRule:
    DependsOn: s2nfuzzerOpenSSL102FIPS
    Properties:
      Description: scheduled run Build with CloudFormation
      Name: s2nfuzzerOpenSSL102FIPSEvent
      ScheduleExpression: cron(0 12 * * ? *)
      State: ENABLED
      Targets:
        - Arn: !GetAtt 's2nfuzzerOpenSSL102FIPS.Arn'
          Id: s2nfuzzerOpenSSL102FIPSCWid
          RoleArn: !GetAtt 's2nEventsInvokeCodeBuildRole.Arn'
    Type: AWS::Events::Rule
  s2nfuzzerOpenSSL111Coverage:
    DependsOn: s2nfuzzerOpenSSL111CoverageRole
    Properties:
      Artifacts:
        ArtifactIdentifier: s2nfuzzerOpenSSL111Coverage
        EncryptionDisabled: true
        Location: s2n-build-artifacts
        Name: s2nfuzzerOpenSSL111CoverageArtifact
        NamespaceType: NONE
        OverrideArtifactName: false
        Packaging: ZIP
        Type: S3
      BadgeEnabled: true
      Environment:
        ComputeType: BUILD_GENERAL1_LARGE
        EnvironmentVariables:
          - Name: S2N_LIBCRYPTO
            Value: openssl-1.1.1
          - Name: LATEST_CLANG
            Value: 'true'
          - Name: TESTS
            Value: fuzz
          - Name: FUZZ_TIMEOUT_SEC
            Value: '60'
          - Name: FUZZ_COVERAGE
            Value: 'true'
          - Name: CODECOV_IO_UPLOAD
            Value: 'true'
        Image: aws/codebuild/standard:5.0
        PrivilegedMode: true
        Type: LINUX_CONTAINER
      Name: s2nfuzzerOpenSSL111Coverage
      SecondaryArtifacts:
        - ArtifactIdentifier: logs
          EncryptionDisabled: true
          Location: s2n-build-artifacts
          Name: logsArtifact
          NamespaceType: NONE
          OverrideArtifactName: false
          Packaging: ZIP
          Type: S3
      ServiceRole: !Ref 's2nfuzzerOpenSSL111CoverageRole'
      Source:
        BuildSpec: codebuild/spec/buildspec_ubuntu_fuzz_artifacts.yml
        GitCloneDepth: '1'
        Location: https://github.com/awslabs/private-s2n-fuzz.git
        ReportBuildStatus: true
        Type: GITHUB
      SourceVersion: ''
      TimeoutInMinutes: '480'
    Type: AWS::CodeBuild::Project
  s2nfuzzerOpenSSL111CoverageRole:
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action:
              - sts:AssumeRole
            Effect: Allow
            Principal:
              Service:
                - codebuild.amazonaws.com
      Description: Policy created by CloudFormation.
      Path: /
      Policies:
        - PolicyDocument:
            Statement:
              - Action:
                  - s3:PutObject
                  - s3:GetObject
                  - s3:GetObjectVersion
                  - s3:GetBucketAcl
                  - s3:GetBucketLocation
                Effect: Allow
                Resource:
                  - arn:aws:s3:::s2n-build-artifacts/*
              - Action:
                  - logs:CreateLogGroup
                  - logs:CreateLogStream
                  - logs:PutLogEvents
                Effect: Allow
                Resource:
                  - arn:aws:logs:us-west-2:024603541914:log-group:/aws/codebuild/s2nfuzzerOpenSSL111Coverage:*
              - Action:
                  - codecommit:BatchGet*
                  - codecommit:BatchDescribe*
                  - codecommit:Describe*
                  - codecommit:EvaluatePullRequestApprovalRules
                  - codecommit:Get*
                  - codecommit:List*
                  - codecommit:GitPull
                Effect: Allow
                Resource:
                  - '*'
          PolicyName: CodeBuildArtifactPolicy
    Type: AWS::IAM::Role
  s2nfuzzerOpenSSL111CoverageRule:
    DependsOn: s2nfuzzerOpenSSL111Coverage
    Properties:
      Description: scheduled run Build with CloudFormation
      Name: s2nfuzzerOpenSSL111CoverageEvent
      ScheduleExpression: cron(0 12 * * ? *)
      State: ENABLED
      Targets:
        - Arn: !GetAtt 's2nfuzzerOpenSSL111Coverage.Arn'
          Id: s2nfuzzerOpenSSL111CoverageCWid
          RoleArn: !GetAtt 's2nEventsInvokeCodeBuildRole.Arn'
    Type: AWS::Events::Rule
